
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>mmwave.dsp.compensation &#8212; mmwave 0.0.1 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="mmwave.dsp.doppler_processing" href="doppler_processing.html" />
    <link rel="prev" title="mmwave.dsp.cfar" href="cfar.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="mmwave-dsp-compensation">
<h1>mmwave.dsp.compensation<a class="headerlink" href="#mmwave-dsp-compensation" title="Permalink to this headline">¶</a></h1>
<dl class="function">
<dt id="mmwave.dsp.compensation.generate_dft_sin_cos_table">
<code class="descclassname">mmwave.dsp.compensation.</code><code class="descname">generate_dft_sin_cos_table</code><span class="sig-paren">(</span><em>dft_length</em><span class="sig-paren">)</span><a class="headerlink" href="#mmwave.dsp.compensation.generate_dft_sin_cos_table" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate SIN/COS table for doppler compensation reference.</p>
<p>Generate SIN/COS table. Also generates Sine/Cosine at half, one thrid and two thirds the bin value.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>dft_len</strong> – (uint32_t) dft_len Length of the DFT. It is used as numDopperBins, which is numCHirpsPerFrame/numTxAntenns.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">ndarray in complex format with generated Sin (image) Cos (real) table.
bins (np.ndarray): Sin/Cos at half, one thrid and two thirds the bin.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">dft_sin_cos_table (np.ndarray)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="mmwave.dsp.compensation.add_doppler_compensation">
<code class="descclassname">mmwave.dsp.compensation.</code><code class="descname">add_doppler_compensation</code><span class="sig-paren">(</span><em>num_doppler_bins</em>, <em>doppler_indices</em>, <em>azimuth_in</em>, <em>num_ant</em>, <em>num_tx_antennas</em><span class="sig-paren">)</span><a class="headerlink" href="#mmwave.dsp.compensation.add_doppler_compensation" title="Permalink to this definition">¶</a></dt>
<dd><p>Compensation of Doppler phase shift in the virtual antennas.</p>
<p>Compensation of Doppler phase shift in the virtual antennas (corresponding to second or third Tx antenna chirps). Symbols
corresponding to virtual antennas, are rotated by half of the Doppler phase shift measured by Doppler FFT. The
phase shift read from the table using half of the object Doppler index  value. If the Doppler index is odd, an
extra half of the bin phase shift is added.</p>
<p>The original function is called per detected objects. This functions is modified to directly compensate the
azimuth_in matrix (numDetObj, num_angle_bins)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>doppler_indices</strong> – (numDetObj). Signed doppler index of the object. Needs to be converted to unsigned first
(0 to numDopperBins-1).</li>
<li><strong>azimuth_mod_coefs</strong> – (cmplx16ImRe_t to uint32_t) Table with cos/sin values SIN in even position, COS in odd position
exp(1j*2*pi*k/N) for k=0,…,N-1 where N is number of Doppler bins.</li>
<li><strong>azimuth_mod_coefs_half_bin</strong> – (cmplx16ImRe_t -&gt; <a href="#id1"><span class="problematic" id="id2">np.complex_</span></a>) exp(1j*2*pi* 0.5 /N)</li>
<li><strong>azimuth_in</strong> – (numDetObj, numVirtualAntennas/2). (cmplx32ReIm_t -&gt; ndarray(dtype=np.complex64)) Input of azimuth FFT.
Only the virtual antennas related to tx2 will be compensated.</li>
<li><strong>num_ant</strong> – (uint32_t) Number of antenna symbols to be Doppler compensated. Should be the number or virtual antennas
related to tx2. No actual meaning in this implementation more than a safeguard.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="mmwave.dsp.compensation.rx_channel_phase_bias_compensation">
<code class="descclassname">mmwave.dsp.compensation.</code><code class="descname">rx_channel_phase_bias_compensation</code><span class="sig-paren">(</span><em>rx_channel_compensations</em>, <em>input</em>, <em>num_antennas</em><span class="sig-paren">)</span><a class="headerlink" href="#mmwave.dsp.compensation.rx_channel_phase_bias_compensation" title="Permalink to this definition">¶</a></dt>
<dd><p>Compensation of rx channel phase bias.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>rx_channel_compensations</strong> – rx channel compensation coefficient.</li>
<li><strong>input</strong> – complex number.</li>
<li><strong>num_antennas</strong> – number of symbols.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="mmwave.dsp.compensation.near_field_correction">
<code class="descclassname">mmwave.dsp.compensation.</code><code class="descname">near_field_correction</code><span class="sig-paren">(</span><em>idx</em>, <em>detected_objects</em>, <em>start_range_index</em>, <em>end_range_index</em>, <em>azimuth_input</em>, <em>azimuth_output</em>, <em>num_angle_bins</em>, <em>num_rx_antennas</em>, <em>range_resolution</em><span class="sig-paren">)</span><a class="headerlink" href="#mmwave.dsp.compensation.near_field_correction" title="Permalink to this definition">¶</a></dt>
<dd><p>Correct phase error as the far-field plane wave assumption breaks.</p>
<p>Calculates near field correction for input detected index (corresponding
to a range position). Referring to top level doxygen &#64;ref
nearFieldImplementation, this function performs the Set 1 rotation with the
correction and adds to Set 0 in place to produce result in Set 0 of the
azimuth_output.</p>
<p>This correction is done per detected objects from CFAR detection</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>idx</strong> – index of the detected objects in detected_objects.</li>
<li><strong>detected_objects</strong> – detected objects matrix with dimension of 100 x 6, where it holds at most 100 objects and 6 members are
rangeIdx, dopplerIdx, peakVal, x, y and z. It is configured as a structured array.</li>
<li><strong>start_range_index</strong> – start range index of near field correction.</li>
<li><strong>end_range_index</strong> – end range index of near field correction.</li>
<li><strong>azimuth_input</strong> – complex array of which length is num_angle_bins+numVirtualAntAzim, where numVirtualAntAzim = 4, 8 or 12
depending on how many Txs are used.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">None. azimuth_output is changed in-place.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="mmwave.dsp.compensation.dc_range_signature_removal">
<code class="descclassname">mmwave.dsp.compensation.</code><code class="descname">dc_range_signature_removal</code><span class="sig-paren">(</span><em>fft_out1_d</em>, <em>positive_bin_idx</em>, <em>negative_bin_idx</em>, <em>calib_dc_range_sig_cfg</em>, <em>num_tx_antennas</em>, <em>num_chirps_per_frame</em><span class="sig-paren">)</span><a class="headerlink" href="#mmwave.dsp.compensation.dc_range_signature_removal" title="Permalink to this definition">¶</a></dt>
<dd><p>Compensation of DC range antenna signature.</p>
<p>Antenna coupling signature dominates the range bins close to the radar. These are the bins in the range FFT output
located around DC. This feature is under user control in terms of enable/disable and start/end range bins through a
CLI command called calibDcRangeSig. During measurement (when the CLI command is issued with feature enabled), each
of the specified range bins for each of the virtual antennas are accumulated over the specified number of chirps
and at the end of the period, the average is computed for each bin/antenna combination for removal after the
measurement period is over. Note that the number of chirps to average must be power of 2. It is assumed that no
objects are present in the vicinity of the radar during this measurement period. After measurement is done, the
removal starts for all subsequent frames during which each of the bin/antenna average estimate is subtracted from
the corresponding received samples in real-time for subsequent processing.</p>
<p>This function has a measurement phase while calib_dc_range_sig_cfg.counter is less than the preferred value and calibration
phase afterwards. The original function is performed per chirp. Here it is modified to be called per frame.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>fft_out1_d</strong> – (num_chirps_per_frame, num_rx_antennas, numRangeBins). Output of 1D FFT.</li>
<li><strong>positive_bin_idx</strong> – the first positive_bin_idx range bins (inclusive) to be compensated.</li>
<li><strong>negative_bin_idx</strong> – the last -negative_bin_idx range bins to be compensated.</li>
<li><strong>calib_dc_range_sig_cfg</strong> – a simple class for calibration configuration’s storing purpose.</li>
<li><strong>num_tx_antennas</strong> – number of transmitters.</li>
<li><strong>num_chirps_per_frame</strong> – number of total chirps per frame.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">None. fft_out1_d is modified in-place.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="mmwave.dsp.compensation.clutter_removal">
<code class="descclassname">mmwave.dsp.compensation.</code><code class="descname">clutter_removal</code><span class="sig-paren">(</span><em>input_val</em>, <em>axis=2</em><span class="sig-paren">)</span><a class="headerlink" href="#mmwave.dsp.compensation.clutter_removal" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform clutter removal by removing the mean from the input_val on the specified axis.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>input_val</strong> (<em>ndarray</em>) – Array to be clutter removed. Usually the input of 2D FFT,        e.g. [numChirpsPerFrame, num_rx_antennas, numRangeBins]. so it is applied along the last axis.</li>
<li><strong>axis</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Axis to calculate mean</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Array with static clutter removed</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">ndarray</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">mmwave</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../dataloader/index.html">mmwave.dataloader</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">mmwave.dsp</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="angle_estimation.html">mmwave.dsp.angle_estimation</a></li>
<li class="toctree-l2"><a class="reference internal" href="cfar.html">mmwave.dsp.cfar</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">mmwave.dsp.compensation</a></li>
<li class="toctree-l2"><a class="reference internal" href="doppler_processing.html">mmwave.dsp.doppler_processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="noise_removal.html">mmwave.dsp.noise_removal</a></li>
<li class="toctree-l2"><a class="reference internal" href="range_processing.html">mmwave.dsp.range_processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.html">mmwave.dsp.utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="zoom_fft.html">mmwave.dsp.ZoomFFT</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tracking/index.html">mmwave.tracking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../clustering/index.html">mmwave.clustering</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">mmwave.dsp</a><ul>
      <li>Previous: <a href="cfar.html" title="previous chapter">mmwave.dsp.cfar</a></li>
      <li>Next: <a href="doppler_processing.html" title="next chapter">mmwave.dsp.doppler_processing</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Arjun, Charles, Dash, Edwin, Jingning, Ruihao.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/dsp/compensation.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>